---
title: "REDCapToCbio"
author: |
  <img src="img/logo-biomeris.png" width="150" style="border: none;">
output:
  pdf_document:
    number_sections: yes
    toc: yes
  html_document:
    number_sections: yes
    toc: yes
vignette: >
  %\VignetteIndexEntry{REDCapToCbio}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Introduzione
===============

Il pacchetto `REDCapToCbio` fornisce funzioni per trasformare automaticamente i dati esportati da REDCap in un formato compatibile con [cBioPortal](https://www.cbioportal.org/).  
In particolare, genera i file clinici strutturati e i file `meta` richiesti, seguendo le specifiche ufficiali disponibili a questo link:  
[https://docs.cbioportal.org/file-formats/](https://docs.cbioportal.org/file-formats/).

Installazione del pacchetto in R
===============

```{r, eval = FALSE}
install.packages("remotes")
remotes::install_github("biomeris/REDCapToCbio")
```

Preparazione dei dati per l'importazione in cBioPortal
===============

Carica il pacchetto con il seguente comando:

```{r setup}
library(REDCapToCbio)
```

Per consultare la documentazione relativa ad una specifica funzione, ad esempio `createStudyFolder`, utilizza il comando:

```{r, eval = FALSE}
?createStudyFolder
```

## Creare la cartella dello studio

Come dichiarato nella [documentazione ufficiale](https://docs.cbioportal.org/data-loading/#preparing-study-data), uno studio da caricare in cBioPortal pu√≤ consistere, in sostanza, in una cartella che contiene tutti i file di dati necessari.
La funzione `createStudyFolder` permette di creare le cartelle relative ai diversi studi in una location specificata dall'utente.

```{r, eval = FALSE}
# Creazione della cartella per lo studio 'brca'
output_folder <- createStudyFolder(
  study_folder = "brca", 
  output_path = "/home/documents/cbioportal"
)
```

## 

```{r, eval = FALSE}
# Define cancer study identifier
cancer_study_identifier <- "brca_joneslab_2013"

# Write Cancer Study metafile
createCancerStudyMetafile(study_folder = output_folder,
                          type_of_cancer = "brca",
                          cancer_study_identifier = cancer_study_identifier,
                          name = "Breast Cancer (Jones Lab 2013)",
                          description = "Comprehensive profiling of 103 breast cancer samples.",
                          add_global_case_list = TRUE)

# Write Cancer Type meta file and data file
createCancerTypeFiles(study_folder = output_folder,
                      type_of_cancer = "brca",
                      name = "Breast Invasive Carcinoma",
                      dedicated_color = "HotPink",
                      parent_type_of_cancer = "Breast")

# Write Clinical Data File - PATIENT_ATTRIBUTES
# Export data from REDCap
redcap_data <- redcapToCbio(
  redcap_uri = Sys.getenv("RC_URL"),
  token = Sys.getenv("TOKEN")
)

# Write files
createClinicalDataFiles(
  study_folder = output_folder,
  cancer_study_identifier = cancer_study_identifier,
  datatype = "PATIENT_ATTRIBUTES",
  clinical_data = redcap_data
)
```
